cmake_minimum_required(VERSION 3.19)

project(chsm 
VERSION 1.0.0
LANGUAGES C CXX ASM
DESCRIPTION "CHSM - Hierarchical State Machine (HSM) Framework for C The project consists of two main parts: an editor (CHSM) to draw state machines and a C library (CRF) that is able to drive the C code generated by the editor.")

########################  External .cmake files includes  ############################ 

include(cmake_utils/cmake_utils.cmake)

########################  Global settings  ############################ 
set(DEBUG ON)
option(CHSM_BUILD_TESTS ON)
set(OUTSIDE_PYTHON_PATH ${$ENV{PYTHON_PATH}})

set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${PROJECT_BINARY_DIR}/${CMAKE_INSTALL_LIBDIR})
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${PROJECT_BINARY_DIR}/${CMAKE_INSTALL_LIBDIR})
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${PROJECT_BINARY_DIR}/${CMAKE_INSTALL_BINDIR})  

# Generate compile_command.json to make it easier to work with clang based tools
set(CMAKE_EXPORT_COMPILE_COMMANDS ON)

message(STATUS "
----------------------> Chsm <-----------------------------------
")

if(CHSM_BUILD_TESTS)
    message(STATUS "----------> Enabled the tests! <-------------------")
    enable_testing()
    set(UNITY_EXTENSION_FIXTURE ON CACHE INTERNAL "Set UNITY_EXTENSION_FIXTURE CACHE INTERNAL.")
    set(UNITY_EXTENSION_MEMORY ON CACHE INTERNAL "Set UNITY_EXTENSION_MEMORY CACHE INTERNAL.")
    # set(UNITY_SUPPORT_64 ON CACHE INTERNAL "Set UNITY_SUPPORT_64 CACHE INTERNAL.")
    
    add_subdirectory(unity)
endif()

add_subdirectory(modules)
add_subdirectory(c_rf)
    