cmake_minimum_required(VERSION 3.19)

project(chsm 
VERSION 1.0.0
LANGUAGES C CXX ASM
DESCRIPTION "CHSM - Hierarchical State Machine (HSM) Framework for C The project consists of two main parts: an editor (CHSM) to draw state machines and a C library (CRF) that is able to drive the C code generated by the editor.")

########################  External .cmake files includes  ############################ 

include(cmake_utils/cmake_utils.cmake)
include(GNUInstallDirs)
include(CMakePackageConfigHelpers)

# find_package(PkgConfig REQUIRED)


########################  Global settings  ############################ 
set(DEBUG ON)
option(CHSM_BUILD_TESTS OFF)
set(OUTSIDE_PYTHON_PATH ${$ENV{PYTHON_PATH}})

set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${PROJECT_BINARY_DIR}/${CMAKE_INSTALL_LIBDIR})
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${PROJECT_BINARY_DIR}/${CMAKE_INSTALL_LIBDIR})
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${PROJECT_BINARY_DIR}/${CMAKE_INSTALL_BINDIR})  

message(STATUS "
----------------------> Chsm <-----------------------------------
")

add_subdirectory(modules)
add_subdirectory(reactive_frameworks/c_rf)
    
if(CHSM_BUILD_TESTS)
    include(FindUnity)
    message(STATUS "----------> Enabled the tests! <-------------------")
    enable_testing()
endif()
# Install ------------------------------------------------------------------------


# write_basic_package_version_file(
#     ${CMAKE_CURRENT_BINARY_DIR}/chsm-config-version.cmake
#     COMPATIBILITY AnyNewerVersion
# )
  
# get_property(EXPORTED_TARGETS GLOBAL PROPERTY chsm_EXPORTED_TARGETS)

# foreach(TARGET ${EXPORTED_TARGETS})
#   get_target_property(INCLUDE_DIR ${TARGET} INTERFACE_INCLUDE_DIRECTORIES)
#   message("${TARGET} include directories: ${INCLUDE_DIR}")
# endforeach()

    
# install(TARGETS ${EXPORTED_TARGETS}
#             NAMESPACE chsm::
#             DESTINATION lib)

# install(FILES
#   ${CMAKE_CURRENT_BINARY_DIR}/chsm-config-version.cmake
#   DESTINATION ${CMAKE_INSTALL_DATADIR}/chsm
# )

# configure_file(
#   ${CMAKE_CURRENT_SOURCE_DIR}/cmake/chsm.pc.in
#   ${CMAKE_CURRENT_BINARY_DIR}/chsm.pc
# )

# install(
#   FILES ${CMAKE_CURRENT_BINARY_DIR}/chsm.pc
#   DESTINATION ${CMAKE_INSTALL_LIBDIR}/pkgconfig
# )